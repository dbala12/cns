---
title: "early_voting_story"
author: "daranee balachandar & taylor nichols"
date: "2024-10-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Libraries

```{r}
# Turn off scientific notation
# load your packages
options(scipen=999)
library(readr)
library(stringr)
library(tidyr)
library(tidyverse)
library(tidycensus)
library(lubridate)
library(refinr)
library(janitor)
library(rvest)
library(httr)
library(dplyr)
library(ggplot2)
```

## Load early votes data
This data is as of Day 5, Sunday, Oct. 28. Early voting in Maryland is between Oct. 24 to Oct. 31.
```{r}
earlyvoting_raw_data <- read_csv("EarlyVoting RAW data.csv")
View(earlyvoting_raw_data)
```

## Clean data
```{r}
# cleaning function
earlyvoting_raw_data <- earlyvoting_raw_data |>
  clean_names()
```

**Task 1: Show the votes for each county for each day**
```{r}
# Convert from wide to long format for easier aggregation
long_data <- earlyvoting_raw_data |> 
   pivot_longer(cols = starts_with("day"), 
              names_to = "day", 
              values_to = "votes")

# Calculate the total votes per county for each day
votes_per_county_per_day <- long_data |> 
   group_by(county_name, day) |> 
   summarize(total_votes = sum(votes, na.rm = TRUE), .groups = 'drop')

# View the results
print(votes_per_county_per_day)
```

**Task 2: Breakdown of votes according to county. upload census and compare by 10,000 per capita**
```{r}
# Load census
census_api_key("6c6f00214ef0eb2cab5b4ff78cf0bd45c520fec3", install=TRUE, overwrite=TRUE)
```

**Task 3: Show which county has the highest early votes in the first 5 days**
```{r}
county_totals<- votes_per_county_per_day |> 
  group_by(county_name) |> 
  summarise(total_early_votes = sum(total_votes)) |> 
  arrange(desc(total_early_votes))
  
county_totals

```
```{r}
census_data <- get_acs(
  geography = "county",
  variables ="B01003_001",
  year = 2022,
  state = "MD",
  survey = "acs5"
)

census_data <- census_data |> 
  rename(county_name = NAME, population = estimate)
  

print(census_data)
```
```{r}
census_data <- census_data |>
  mutate(county_name = if_else(
    county_name %in% c("Baltimore City", "Baltimore County"),
    county_name,
    str_replace(county_name, " County, Maryland", "") 
  ))

census_data
```
```{r}
census_data <- census_data |> 
  mutate(county_name = case_when(
    county_name == "Baltimore" ~ "Baltimore County",
    county_name == "Baltimore city, Maryland" ~ "Baltimore City",
    TRUE ~ county_name  
  ))

census_data
```
```{r}
county_pop_vote_early <- county_totals |> 
  left_join(census_data, by = "county_name")

county_pop_vote_early
```

```{r}
county_vote_breakdown_pop <- county_pop_vote_early |> 
  mutate(votes_per_10000 = (total_early_votes / population) * 10000) |> 
  arrange(desc(votes_per_10000))

county_vote_breakdown_pop

```

```{r}
ggplot(county_vote_breakdown_pop, aes(x = reorder(county_name, votes_per_10000), y = votes_per_10000)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  coord_flip() +  # Flip coordinates for better readability
  labs(
    title = "Early Votes per 10,000 People by County",
    x = "County",
    y = "Votes per 10,000 People"
  ) +
  theme_minimal()
```

**early votes by party and county**

```{r}
# Check the structure and column names of the dataset
str(earlyvoting_raw_data)
colnames(earlyvoting_raw_data)
```
```{r}
total_votes_by_county_party <- earlyvoting_raw_data |> 
  filter(party_code %in% c("DEM", "REP", "UNA")) |> 
  group_by(county_name, party_code) |> 
  summarise(total_votes = sum(day1, day2, day3, day4, day5, day6, day7, day8, na.rm = TRUE), .groups = 'drop') |> 
  arrange(desc(total_votes)) 

total_votes_by_county_party


```

```{r}
ggplot(total_votes_by_county_party, aes(x = reorder(county_name, total_votes), y = total_votes, fill = party_code)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Total Early Votes by County and Party",
       x = "County Name",
       y = "Total Votes") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set1") + 
  coord_flip() 

```

**Task 5: What is the breakdown of women voters and men voters**

```{r}
vote_early_data <- earlyvoting_raw_data |> 
  mutate(across(starts_with("day"), ~ as.numeric(.)))

total_votes_by_gender <- vote_early_data |> 
  group_by(gender_code) |> 
  summarise(total_votes = sum(day1, day2, day3, day4, day5, day6, day7, day8, na.rm = TRUE), .groups = 'drop')

total_votes_by_gender
```

**MEMO**

According to early voting data up to day 5, Oct. 28, women are leading in voting early at 315,869 with men at 251,338. 

Queen Anne's, Talbot, Calvert, Harford and Charles Counties have most early votes per 10,000 in the population. But Montgomery County is leading is most number of early votes. Democrats are leading in Montgomery County, PG County, Baltimore County, Baltimore City and Howard County.